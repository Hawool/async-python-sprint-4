# Проектное задание четвертого спринта

Спроектирован и реализован сервис для создания сокращенной формы передаваемых URL и анализа активности их использования.

#### Подготовка к работе
- `git clone https://github.com/Hawool/async-python-sprint-4.git`
- `cd async-python-sprint-4`
- `python -m venv venv`
- `source venv/bin/activate`
- `pip install -r requirements.txt`
- запуск БД на 5555 порту `docker run   --rm     --name postgres-fastapi   -p 5555:5432   -e POSTGRES_USER=postgres   -e POSTGRES_PASSWORD=postgres   -e POSTGRES_DB=collection   -d postgres:14.5`
- миграции: `alembic upgrade head`
- запуск сервера `python3 main.py`
- Тесты: `pytest`

## Методы

<details>
<summary> Список необходимых эндпойнтов (можно изменять) </summary>

1. Получить сокращенный вариант переданного URL
```python
POST /
```

Метод принимает в теле запроса строку URL для сокращения и возвращает ответ с кодом `201`.

2. Вернуть оригинальный URL
```python
GET /<url_id>
```
Метод принимает в качестве параметра идентификатор сокращенного URL и возвращает ответ с кодом `307` и оригинальным URL в заголовке `Location`.

3. Вернуть статус использования URL
```python
GET /<url_id>/status
```
Метод принимает в качестве параметра идентификатор сокращенного URL и возвращает информацию о количестве переходов, совершенных по ссылке.

</details>


### Дополнительные требования (отметить [Х] выбранные пункты):

- [Х] (1 балл) Реализуйте метод `GET /ping`, который возвращает информацию о статусе доступности БД.
- [Х] (1 балл) Реализуйте возможность "удаления" сохраненного URL. Запись должна оставаться, но помечаться как удаленная. При попытке получения полного URL возвращать ответ с кодом `410 Gone`.

- [Х] (2 балла) Реализуйте **middlware**, блокирующий доступ к сервису запросов из запрещенных подсетей (black list).
- [ ] (2 балла) Реализуйте возможность передавать ссылки пачками (batch upload).

<details>
<summary> Описание изменений </summary>

- Метод `POST /shorten` принимает в теле запроса список URL в формате:
```python
[
    {
        "original_url": "URL for shorten"
    },
    ...
]

```
и возвращает данные в формате:
```python
[
    {
        "url_id": "<text-id>",
        "short_url": "https://...",
    },
    ...
]
```
</details>



- [ ] (3 балла) Реализуйте взаимодействие с сервисом авторизованного пользователя. Пользователь может создавать как приватные, так и публичные ссылки или изменять видимость ссылок. Вызов метода `GET /user/status` возвращает все созданные ранее ссылки в формате:

```
[
    {
        "short_id": "<text-id>",
        "short_url": "https://...",
        "original_url": "https://...",
        "type": "<public|private>"
    },
    ...
]
```

- [ ] **(5 баллов) Реализовать кастомную реализацию взаимодействия с БД. Учесть возможность работы с транзакциями.


## Требования к решению

1. Используйте фреймворк FastAPI. В качестве СУБД используйте PostgreSQL (не ниже 10).
2. Используйте концепции ООП.
3. Предусмотрите обработку исключительных ситуаций. 
4. Приведите стиль кода в соответствие pep8, flake8, mypy. 
5. Логируйте результаты действий. 
6. Покройте написанный код тестами. 
